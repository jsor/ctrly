/*!
 * ctrly v0.7.0
 * Copyright (c) 2018-2020 Jan Sorgalla
 * License: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).ctrly=e()}(this,(function(){"use strict";function t(){try{var t=document.activeElement;return t&&t.nodeName?t:document.body}catch(t){return document.body}}function e(t){for(var e=[];t&&t.parentNode&&1===t.parentNode.nodeType;)t=t.parentNode,e.push(t);return e}function n(t){var n=e(t).map((function(t){return[t,t.scrollTop,t.scrollLeft]}));return function(){n.forEach((function(t){t[0].scrollTop=t[1],t[0].scrollLeft=t[2]}))}}function r(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.restoreScrollPosition;o&&(e=n(t));try{t.focus()}catch(t){}e&&e()}function o(t,e){if(!t)return!1;var n=t.matches||t.webkitMatchesSelector||t.msMatchesSelector;return"function"==typeof n&&n.call(t,e)}function i(t,e){if(!t)return null;if("function"==typeof t.closest)return t.closest(e);do{if(o(t,e))return t;t=t.parentNode}while(t&&1===t.nodeType);return null}function u(t,e){return t&&"function"==typeof t.querySelectorAll?[].slice.call(t.querySelectorAll(e)):[]}var a,c=["a[href]","area[href]","input","select","textarea","button","iframe","object","audio[controls]","video[controls]","[contenteditable]","[tabindex]"].join(","),l=/^(input|select|textarea|button|object)$/;function s(t){var e=t.nodeName.toLowerCase();if("area"===e)return function(t){var e=t.parentNode,n=e.name;if(!t.href||!n||"map"!==e.nodeName.toLowerCase())return!1;var r=u(document,'img[usemap="#'.concat(n,'"]'));return r.length>0&&p(r[0])}(t);if(t.disabled)return!1;if(l.test(e)){var n=i(t,"fieldset");if(n&&n.disabled)return!1}return p(t)}function d(t){var e=v(t);return s(t)&&e>=0}function f(t,e){var n=v(t,!0),r=v(e,!0);return n===r?2&t.compareDocumentPosition(e)?1:-1:n-r}function p(t){var n=getComputedStyle(t);return"hidden"!==n.visibility&&"collapse"!==n.visibility&&"none"!==n.display&&e(t).every((function(t){return"none"!==getComputedStyle(t).display}))}function v(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=parseInt(t.getAttribute("tabindex"),10);return isNaN(n)||e&&n<0?0:n}function b(t){return o(t,c)&&d(t)}function m(){if(a)return a;a={capture:!1,once:!1,passive:!1};var t={get capture(){return a.capture=!0,!1},get once(){return a.once=!0,!1},get passive(){return a.passive=!0,!1}};return window.addEventListener("test",t,t),window.removeEventListener("test",t,t),a}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=m(),n=e.once,r=e.passive,o=e.capture;return n||r||o?(n||delete t.once,r||delete t.passive,o||delete t.capture,t):Boolean(t.capture)}function y(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{capture:!1};t&&"function"==typeof t.removeEventListener&&t.removeEventListener(e,n,h(r))}function A(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{capture:!1};if(!t||"function"!=typeof t.addEventListener)return function(){};var o=n,i=function(){y(t,e,o,r)};return r.once&&!m().once&&(o=function(e){i(),n.call(t,e)}),t.addEventListener(e,o,h(r)),i}function g(t,e,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{capture:!1},u=!0===o.once;delete o.once;var a=A(t,e,(function(t){var e=i(t.target,n);e&&(u&&a(),r.call(e,t,e))}),o);return a}function E(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t||"function"!=typeof t.dispatchEvent)return!0;r.bubbles=r.bubbles||!1,r.cancelable=r.cancelable||!1,r.composed=r.composed||!1,r.detail=r.detail||null;try{n=new CustomEvent(e,r)}catch(t){(n=document.createEvent("CustomEvent")).initCustomEvent(e,r.bubbles,r.cancelable,r.detail)}return t.dispatchEvent(n)}function w(t){var e=document.readyState;"complete"!==e&&"interactive"!==e?document.addEventListener("DOMContentLoaded",(function(){t()}),h({capture:!0,once:!0,passive:!0})):setTimeout(t,0)}function x(t,e){var n=arguments.length>1?e:document;return n&&"function"==typeof n.querySelectorAll?[].slice.call(n.querySelectorAll(t)):[]}function L(t){return u(arguments.length>0?t:document,c).filter(d).sort(f)}var O={selector:"[data-ctrly]",context:null,focusTarget:!0,closeOnBlur:!0,closeOnEsc:!0,closeOnOutsideClick:!0,closeOnScroll:!1,trapFocus:!1,allowMultiple:!1,on:null,autoInit:!0};function C(t){var e={};return[O,t].forEach((function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})),e}function N(t){return"which"in t?t.which:t.keyCode}function S(t){return x('[aria-controls="'.concat(t.id,'"]'))}function k(t){return document.getElementById(t.getAttribute("aria-controls")||t.getAttribute("data-ctrly"))}function D(t){t.removeAttribute("aria-pressed"),t.removeAttribute("aria-controls"),t.removeAttribute("aria-expanded")}var T=0;return function(){var e,n,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=C(o),a=u.selector,c=u.on||{},l={};function s(t){return u.context?i(t,u.context):document}function d(t,e){return("function"!=typeof c[e]||!1!==c[e](t))&&!1!==E(t,"ctrly:".concat(e),{bubbles:!0,cancelable:!0})}function f(t){for(var e=t;e;){if(e.id&&l[e.id])return e;e=e.parentElement}}function p(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;if(!e.hasAttribute("data-ctrly-opened"))return!1;if(!d(e,"close"))return!1;var o=t(),i=l[e.id]||{},u=i.lastActiveElement,a=i.destroy;return delete l[e.id],a&&a(),S(e).forEach((function(t){"button"!==t.tagName.toLowerCase()&&t.setAttribute("aria-pressed","false"),t.setAttribute("aria-expanded","false")})),e.removeAttribute("data-ctrly-opened"),e.setAttribute("aria-hidden","true"),e.removeAttribute("tabindex"),e.blur(),n&&u&&e.contains(o)&&r(u,{restoreScrollPosition:!0}),d(e,"closed"),e}function v(t){x(a,s(t)).forEach((function(e){var n=k(e);n&&n.id!==t.id&&p(n,!1)}))}function m(e,n){var o=[];if(u.closeOnBlur&&!u.trapFocus&&o.push(A(document,"focusin",(function(t){n.contains(t.target)||setTimeout((function(){p(n,!1)}),0)}),{capture:!0,passive:!0})),u.closeOnEsc&&o.push(A(document,"keydown",(function(t){27===N(t)&&p(n)&&t.preventDefault()}))),u.closeOnOutsideClick&&o.push(A(document,"click",(function(t){1!==N(t)||n.contains(t.target)||i(t.target,a)||p(n)}),{passive:!0})),u.closeOnScroll){var c=!1,l=function(){c=!0},s=function(){c=!1};o.push(A(n,"mouseenter",l,{passive:!0})),o.push(A(n,"mouseleave",s,{passive:!0})),o.push(A(n,"touchstart",l,{passive:!0})),o.push(A(n,"touchend",s,{passive:!0})),o.push(A(window,"scroll",(function(){c||p(n)}),{passive:!0}))}return u.trapFocus&&o.push(A(document,"keydown",(function(e){if(9===N(e)){var o=L(n);if(!o[0])return e.preventDefault(),void r(n);var i=t(),u=o[0],a=o[o.length-1];if(e.shiftKey&&i===u)return e.preventDefault(),void r(a);e.shiftKey||i!==a||(r(u),e.preventDefault())}}))),function(){for(;o.length;)o.shift().call()}}function h(e){var n=k(e);return n?!n.hasAttribute("data-ctrly-opened")&&(!!d(n,"open")&&(l[n.id]={lastActiveElement:t(),destroy:m(0,n)},S(n).forEach((function(t){"button"!==t.tagName.toLowerCase()&&t.setAttribute("aria-pressed","true"),t.setAttribute("aria-expanded","true")})),n.setAttribute("data-ctrly-opened",""),n.setAttribute("aria-hidden","false"),n.setAttribute("tabindex","-1"),d(n,"opened"),n)):(D(e),!1)}function y(t,e){var n=k(e);n?"true"!==e.getAttribute("aria-expanded")?(u.allowMultiple||v(n),h(e),n&&(t.preventDefault(),u.focusTarget&&r(L(n)[0]||n),n.scrollTop=0,n.scrollLeft=0)):p(n)&&t.preventDefault():p(f(e))&&t.preventDefault()}function O(){e||(e=g(document,"click",a,(function(t,e){1===N(t)&&y(t,e)})),n=g(document,"keydown",a,(function(t,e){13!==N(t)&&32!==N(t)||y(t,e)}))),x(a).forEach((function(t){var e=k(t);if(e){"button"!==t.tagName.toLowerCase()&&(t.hasAttribute("role")||t.setAttribute("role","button"),b(t)||t.setAttribute("tabindex","0")),t.setAttribute("aria-controls",e.id);var n=S(e).map((function(t){return t.id||t.setAttribute("id","ctrly-control-"+ ++T),t.id})),r=(e.getAttribute("aria-labelledby")||"").split(" ").concat(n).filter((function(t,e,n){return""!==t&&n.indexOf(t)===e}));e.setAttribute("aria-labelledby",r.join(" ")),"true"===t.getAttribute("aria-expanded")||t.hasAttribute("data-ctrly-open")?h(t):("button"!==t.tagName.toLowerCase()&&t.setAttribute("aria-pressed","false"),t.setAttribute("aria-expanded","false"),e.setAttribute("aria-hidden","true"),e.removeAttribute("tabindex"))}else D(t)}))}function j(t){for(var r in t&&e&&(e(),e=null,n(),n=null),x(a).forEach((function(e){t&&D(e);var n=k(e);n&&(p(n,!1),t&&n.removeAttribute("aria-hidden"))})),l)Object.prototype.hasOwnProperty.call(l,r)&&(l[r].destroy(),delete l[r])}function M(){j(!1)}function P(){j(!0)}return u.autoInit&&w(O),{closeAll:M,destroy:P,init:O}}}));
